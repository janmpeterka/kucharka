{% from "macros/turbo.html.j2" import button_to %}

<tr id="ingredient-{{ingredient.id}}">

    <td class="align-middle">{{ link_to(ingredient) }}</td>
    
    <td> 
        {% if ingredient.is_measured %}
        <form action="{{ url_for('EditRecipeView:change_ingredient_amount', recipe_id=recipe.id, ingredient_id=ingredient.id) }}" class="form form-inline" method="post">
            <div class="col-8">
                <input type="number" class="form-control" name="amount" step="0.01" min="0"
                       value="{% if ingredient.amount %}{{ (ingredient.amount|float * recipe.portion_count|float) | int }}{% endif %}">
                       {# onblur="this.form.submit()"> #}
                <span class="ml-2">{{ ingredient.measurement.name }}</span>
            </div>
            <input type="submit" class="form-control btn btn-warning ml-4" value="Uložit">
        </form>
        {% endif %}
        <details>
            <summary>Komentář</summary>
              <form action="{{ url_for('EditRecipeView:change_ingredient_comment', recipe_id=recipe.id, ingredient_id=ingredient.id) }}" class="form form-inline" method="post">
            <div class="col-8">
                <input type="text" class="form-control" name="comment"
                       value="{% if ingredient.comment %}{{ ingredient.comment }}{% endif %}">
                       {# onblur="this.form.submit()"> #}
            </div>
            <input type="submit" class="form-control btn btn-warning ml-4" value="Uložit komentář">
        </form>
        </details>
    </td>
    
    <td>
        {% if ingredient.is_measured is false %}
            {{ button_to(action=url_for('EditRecipeView:change_ingredient_measured', recipe_id=recipe.id, ingredient_id=ingredient.id, measured=True), class="measurement", icon=True, value="⚖️") }}
        {% else %}
            {{ button_to(action=url_for('EditRecipeView:change_ingredient_measured', recipe_id=recipe.id, ingredient_id=ingredient.id, measured=False), class="no-measurement", icon=True, value="⚖️") }}
        {% endif %}
    </td>

    <td class="align-middle">
        {% if ingredient.amount %}
            <span class="font-italic font-weight-light"> {{ ingredient.amount | round(1) }} na porci </span>
        {% endif %}
    </td>

    <td class="align-middle">
        {% if ingredient.comment %}
            <span class="font-italic font-weight-light"> {{ ingredient.comment }} </span>
        {% endif %}
    </td>

    <td>
        <form method="POST" action="{{ url_for('EditRecipeView:remove_ingredient', ingredient_id=ingredient.id, recipe_id=recipe.id) }}">
            <button type="submit" class="destroy icon mt-2">&#10005;</button>
        </form>
    </td>
</tr>