{% extends "base/base.html.j2" %}
{% block title %} {{ texts.recipe }} {% endblock %}

{% block content %}

<div class="mb-2" id="recipe-info">
    <div> 
        <h2> {{ recipe.name }} </h2> 
    </div>
    
    <div>
        <span class="font-italic"> Kategorie: {{ recipe.category.name }} </span><br>

        {% if recipe.is_shared and not recipe.is_current_user_author %}
            <span class="font-italic font-weight-light float-right"> (vytvořil*a {{ recipe.author.name }}) </span>
        {% elif recipe.is_shared %}
            <span class="font-italic font-weight-light float-right"> {{ icon("shared") }} </span>
        {% endif %}
    </div>
    <div>
        {% if not print %}
            <span class="float-right">
            {% if recipe.is_vegetarian %}
                {{ icon("vegetarian")}}
            {% endif %}
            {% if recipe.is_vegan %}
                {{ icon("vegan")}}
            {% endif %}
            {% if recipe.lactose_free %}
                {{ icon("lactose_free")}}
            {% endif %}
            {% if recipe.gluten_free %}
                {{ icon("gluten_free")}}
            {% endif %}
            </span>
        {% endif %}
    </div>
</div>


<table id="ingredients" class="table">
    <tr>
        <th>{{ texts.title }}</th>
        <th>Množství (na {{recipe.portion_count}} porcí)</th>
        {# <th>{{ texts.amount_simple }}</th> #}
        <th></th>
    </tr>

    {% for ingredient in recipe.ingredients: %}
    {% set ingredient_amount = ingredient.amount * recipe.portion_count %}
        <tr>
            {% if not print %}
                
            <td>{{ link_to(ingredient) }}
                {% if ingredient.is_public %} {{ icon("public", class="text-secondary") }} {% endif %}
            </td>
            {% else %}
                <td>{{ ingredient.name }}</td>
            {% endif %}

            <td>
            {% if ingredient.is_measured %}
                {% if ingredient.measurement.thousand_fold and ingredient_amount % 1000 != ingredient_amount %}
                    {{ formatted_amount(ingredient_amount/1000) }} {{ ingredient.measurement.thousand_fold }}
                {% else %}
                    {{ formatted_amount(ingredient_amount) }} {{ ingredient.measurement.name }}
                {% endif %}

                {% if ingredient.alternative_measurement %}
                    <abbr title="~= {{ formatted_amount(ingredient_amount/ingredient.alternative_measurement.amount_from * ingredient.alternative_measurement.amount_to) }} {{ingredient.alternative_measurement.to_measurement.name}}">
                         {{ icon("info-circle", class="ml-1") }}
                    </abbr>   
                {% endif %}

            {% endif %}
            </td>

            <td><em>{{ ingredient.comment|default("", True) }}</em></td>
        </tr>
    {% endfor %}
</table>

<hr>

{% if recipe.description %}
    {% include "recipes/_description.html.j2" %}
{% endif %}

{% if not print %}
    


{% if recipe.can_current_user_edit %}
<div class="mb-5">
    <form action="{{ url_for('RecipesView:delete', id=recipe.id) }}" method="post" class="form-inline" onsubmit="return confirm('{{ texts.recipe_delete_confirm }}');">
        <a class="btn btn-warning" href="{{ url_for('RecipesView:edit', id=recipe.id) }}">{{ texts.edit }} {{ icon("edit") }}</a>
        {% if recipe.is_used %}
            <button type="submit" class="btn btn-danger" disabled="">Nelze smazat, je použit {{ icon("delete") }}</button>
        {% else %}
            <button type="submit" class="btn btn-danger">{{ texts.recipe_delete }} {{ icon("delete") }}</button>
        {% endif %}
    </form>
    <form action="{{ url_for('RecipesView:toggle_shared', id=recipe.id) }}" method="post" class="form-inline">
        {% if recipe.is_shared == True %}
            <button type="submit" class="btn btn-secondary">{{ texts.recipe_unshare }} {{ icon("unshare") }}</button>
        {% else %}
            <button type="submit" class="btn btn-secondary">{{ texts.recipe_share }} {{ icon("share") }}</button>
        {% endif %}
    </form>
</div>
{% endif %}

{% if not recipe.is_current_user_author %}
<div class="mt-2 mb-1">
    <a class="btn btn-info" href="{{ url_for('RecipesView:duplicate', id=recipe.id) }}">
        Zkopírovat do mých receptů
    </a>
</div>
{% endif %}

<details>
    <summary>Zobrazit pro daný počet porcí</summary>
    <div class="ml-2">
        
        <a class="btn color-white bg-color-blue" href="{{ url_for('RecipesView:show', id=recipe.id, portion_count=1) }}">Jedna porce</a>
        <a class="btn color-white bg-color-purple ml-1" href="{{ url_for('RecipesView:show', id=recipe.id, portion_count=13) }}">Třináct porcí</a>
        <a class="btn color-white bg-color-purple ml-1" href="{{ url_for('RecipesView:show', id=recipe.id) }}">Původní</a>

        <form method="POST" action="{{ url_for('RecipesView:show_with_portion_count', id=recipe.id) }}" class="form form-inline">
            <input type="number" name="portion_count" min="1" class="form-control" value=1>
            <button type="submit" class="btn btn-primary">Zobrazit pro daný počet porcí</button>
        </form>
    
    </div>
</details>

<details >
    <summary>Další možnosti</summary>
    <a class="btn color-white bg-color-red ml-2" href="{{ url_for('RecipesView:pdf', id=recipe.id, portion_count=recipe.portion_count) }}" target="_blank">Zobrazit PDF</a>
</details>

{% endif %}

{% endblock %}

